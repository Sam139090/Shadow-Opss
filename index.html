<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Shadow Ops</title>
  <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    @font-face {
      font-family: 'Vazirmatn';
      src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/fonts/webfonts/Vazirmatn-Regular.woff2') format('woff2');
      font-weight: 400;
    }
    * { -webkit-tap-highlight-color: transparent; user-select: none; }

    :root {
      --primary: #B3E5FC;
      --secondary: #FFFFFF;
      --accent: #00E5FF;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    .font-persian { font-family: 'Vazirmatn', 'Tahoma', sans-serif; }
    .font-english { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif; }

    .glass {
      background: var(--glass-bg);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border: 1px solid var(--glass-border);
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        inset 0 -1px 0 rgba(0, 0, 0, 0.1);
    }

    .glass-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.4),
        inset 0 2px 0 rgba(255, 255, 255, 0.3),
        inset 0 -2px 0 rgba(0, 0, 0, 0.2);
    }

    .glass-button {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow:
        0 8px 24px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .glass-button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow:
        0 12px 32px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.5),
        0 0 20px var(--primary);
    }

    .glass-button:active { transform: translateY(1px) scale(0.98); }

    .glow-primary { box-shadow: 0 0 40px var(--primary), 0 0 80px rgba(179, 229, 252, 0.3); }
    .glow-accent { box-shadow: 0 0 30px var(--accent), 0 0 60px rgba(0, 229, 255, 0.2); }
    .glow-danger { box-shadow: 0 0 40px #FF1744, 0 0 80px rgba(255, 23, 68, 0.4); }
    .glow-success { box-shadow: 0 0 40px #00E676, 0 0 80px rgba(0, 230, 118, 0.4); }

    .breathing { animation: breathe 3s ease-in-out infinite; }
    @keyframes breathe { 0%, 100% { opacity: 0.7; transform: scale(1);} 50% { opacity: 1; transform: scale(1.02);} }

    .float { animation: float 4s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0px);} 50% { transform: translateY(-10px);} }

    .shake { animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97); }
    @keyframes shake { 0%, 100% { transform: translateX(0);} 10%, 30%, 50%, 70%, 90% { transform: translateX(-4px);} 20%, 40%, 60%, 80% { transform: translateX(4px);} }

    .pulse-glow { animation: pulseGlow 2s ease-in-out infinite; }
    @keyframes pulseGlow { 0%, 100% { filter: brightness(1);} 50% { filter: brightness(1.3);} }

    .slide-up { animation: slideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(40px);} to { opacity: 1; transform: translateY(0);} }

    .slide-down { animation: slideDown 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-40px);} to { opacity: 1; transform: translateY(0);} }

    .scale-in { animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.8);} to { opacity: 1; transform: scale(1);} }

    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0;} to { opacity: 1;} }

    .fade-out { animation: fadeOut 0.3s ease-out forwards; }
    @keyframes fadeOut { from { opacity: 1;} to { opacity: 0;} }

    .timer-ring { stroke-dasharray: 440; stroke-dashoffset: 0; transform-origin: center; transform: rotate(-90deg); }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--primary);
      border-radius: 50%;
      pointer-events: none;
      animation: particleFloat 8s ease-in-out infinite;
    }

    @keyframes particleFloat {
      0%, 100% { transform: translateY(0) translateX(0) scale(1); opacity: 0.3; }
      25% { transform: translateY(-30px) translateX(10px) scale(1.2); opacity: 0.6; }
      50% { transform: translateY(-60px) translateX(-10px) scale(0.8); opacity: 0.4; }
      75% { transform: translateY(-30px) translateX(20px) scale(1.1); opacity: 0.5; }
    }

    .bg-gradient {
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 25%, #0f0f2f 50%, #1a1a3a 75%, #0a0a1a 100%);
    }

    .spy-reveal { animation: spyReveal 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    @keyframes spyReveal {
      0% { opacity: 0; transform: scale(0.5) rotateY(90deg); filter: blur(10px); }
      50% { filter: blur(5px); }
      100% { opacity: 1; transform: scale(1) rotateY(0deg); filter: blur(0); }
    }

    .word-reveal { animation: wordReveal 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
    @keyframes wordReveal {
      0% { opacity: 0; transform: translateY(20px) scale(0.9); filter: blur(8px); }
      100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
    }

    .ripple { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.4); transform: scale(0); animation: rippleEffect 0.6s ease-out; pointer-events: none; }
    @keyframes rippleEffect { to { transform: scale(4); opacity: 0; } }

    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--primary);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 20px var(--primary);
      transition: all 0.2s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); box-shadow: 0 0 30px var(--primary); }

    input[type="color"] {
      -webkit-appearance: none;
      appearance: none;
      width: 60px;
      height: 60px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      background: transparent;
    }
    input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    input[type="color"]::-webkit-color-swatch {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      box-shadow: 0 0 20px currentColor;
    }

    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }
    .stagger-5 { animation-delay: 0.5s; }

    .screen {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }
    .screen.active { opacity: 1; pointer-events: auto; }

    .voted { border: 3px solid var(--accent) !important; box-shadow: 0 0 30px var(--accent) !important; }

    /* Secondary color actually applied (fix) */
    #playerCountDisplay, #durationDisplay, #spyCountDisplay { color: var(--secondary) !important; }

    /* Settings UI */
    .settings-btn {
      position: fixed;
      top: 14px;
      right: 14px;
      z-index: 60;
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      cursor: pointer;
      background: linear-gradient(135deg, rgba(255,255,255,0.20) 0%, rgba(255,255,255,0.08) 100%);
      border: 1px solid rgba(255,255,255,0.25);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 14px 40px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.25);
      transition: transform 0.2s ease;
    }
    .settings-btn:active { transform: scale(0.97); }
    .settings-gear {
      font-size: 26px;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,0.55));
      transform: translateZ(0);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: 70;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }
    .modal-backdrop.active { opacity: 1; pointer-events: auto; }

    .settings-modal {
      position: fixed;
      inset: 0;
      z-index: 80;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
    }
    .settings-modal.active { opacity: 1; pointer-events: auto; }

    .toggle {
      width: 52px;
      height: 30px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(255,255,255,0.22);
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .toggle::after {
      content: '';
      position: absolute;
      top: 4px;
      left: 4px;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--secondary);
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      transition: all 0.2s ease;
    }
    .toggle.on { background: rgba(0,229,255,0.18); border-color: rgba(0,229,255,0.35); box-shadow: 0 0 26px rgba(0,229,255,0.18); }
    .toggle.on::after { left: 26px; background: var(--accent); }

    .accordion-btn { width: 100%; }
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.25s ease; }
    .accordion-content.open { max-height: 240px; }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(255,255,255,0.08);
      cursor: pointer;
      transition: transform 0.15s ease;
    }
    .chip:active { transform: scale(0.98); }
    .chip.selected { border-color: rgba(0,229,255,0.45); box-shadow: 0 0 22px rgba(0,229,255,0.18); }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      z-index: 90;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.20);
      color: rgba(255,255,255,0.92);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: 0 14px 40px rgba(0,0,0,0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      max-width: min(92vw, 520px);
      text-align: center;
    }
    .toast.show { opacity: 1; }
  </style>
</head>
<body class="h-full bg-gradient font-english overflow-hidden">
  <div id="app" class="h-full w-full relative overflow-auto">
    <!-- Particles Container -->
    <div id="particles" class="fixed inset-0 pointer-events-none overflow-hidden"></div>

    <!-- Settings Button -->
    <button id="settingsBtn" class="settings-btn" aria-label="Settings" onclick="openSettings()">
      <span class="settings-gear">âš™ï¸</span>
    </button>

    <!-- Settings Modal -->
    <div id="settingsBackdrop" class="modal-backdrop" onclick="closeSettings()"></div>
    <div id="settingsModal" class="settings-modal">
      <div class="glass-card rounded-3xl w-full max-w-xl p-6 md:p-8">
        <div class="flex items-center justify-between mb-6">
          <h3 id="settingsTitle" class="text-2xl md:text-3xl font-bold text-white" style="text-shadow: 0 0 24px var(--primary);">Settings</h3>
          <button class="glass-button px-4 py-2 rounded-xl text-white/80" onclick="closeSettings()">âœ•</button>
        </div>

        <div class="space-y-6">
          <!-- Language -->
          <div class="glass rounded-2xl p-4">
            <div class="flex items-center justify-between">
              <p id="settingsLangLabel" class="text-white/80 font-semibold">Language</p>
              <div class="flex gap-2">
                <button id="settingsLangEn" class="chip" onclick="setLanguageFromSettings('en')">ğŸ‡¬ğŸ‡§ <span class="text-white">English</span></button>
                <button id="settingsLangFa" class="chip" onclick="setLanguageFromSettings('fa')">ğŸ‡®ğŸ‡· <span class="text-white font-persian">ÙØ§Ø±Ø³ÛŒ</span></button>
              </div>
            </div>
          </div>

          <!-- Toggles -->
          <div class="glass rounded-2xl p-4 space-y-4">
            <div class="flex items-center justify-between">
              <p id="settingsSfxLabel" class="text-white/80 font-semibold">Sound Effects</p>
              <div id="toggleSfx" class="toggle" onclick="toggleSfx()"></div>
            </div>
            <div class="flex items-center justify-between">
              <p id="settingsHapticsLabel" class="text-white/80 font-semibold">Vibration</p>
              <div id="toggleHaptics" class="toggle" onclick="toggleHaptics()"></div>
            </div>
          </div>

          <!-- Difficulty Stats -->
          <div class="glass rounded-2xl p-4">
            <p id="settingsStatsLabel" class="text-white/80 font-semibold mb-3">Unused Words</p>
            <div class="space-y-2 text-white/80" id="difficultyStats"></div>
          </div>

          
          <button id="btnResetUsedWords" class="glass-button w-full py-3 rounded-2xl text-base font-semibold text-white/90" onclick="resetUsedWords()">
            â™»ï¸ Reset used words
          </button>

          <button class="glass-button w-full py-4 rounded-2xl text-lg font-semibold text-white glow-primary" onclick="closeSettings()">OK</button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"></div>

    <!-- Setup Screen (start here) -->
    <div id="setupScreen" class="screen active">
      <div class="w-full max-w-lg">
        <h2 id="setupTitle" class="text-4xl md:text-5xl font-bold text-white text-center mb-10 slide-down" style="text-shadow: 0 0 30px var(--primary);">
          Game Setup
        </h2>

        <div class="glass-card rounded-3xl p-6 md:p-8 space-y-8 scale-in">
          <!-- Player Count -->
          <div class="slide-up stagger-1">
            <div class="flex justify-between items-center mb-3">
              <label id="labelPlayers" class="text-white/80 text-lg">Players</label>
              <span id="playerCountDisplay" class="text-2xl font-bold glow-accent px-4 py-1 rounded-full glass">4</span>
            </div>
            <input type="range" id="playerSlider" min="3" max="12" value="4" class="w-full" oninput="updatePlayerCount(this.value)">
          </div>

          <!-- Spy Count -->
          <div class="slide-up stagger-2">
            <div class="flex justify-between items-center mb-3">
              <label id="labelSpies" class="text-white/80 text-lg">Spies</label>
              <span id="spyCountDisplay" class="text-2xl font-bold glow-accent px-4 py-1 rounded-full glass">1</span>
            </div>
            <input type="range" id="spySlider" min="1" max="1" value="1" class="w-full" oninput="updateSpyCount(this.value)">
            <p id="spyLimitHint" class="text-white/50 text-sm mt-2">Spies cannot be more than players - 1</p>
          </div>

          <!-- Game Duration -->
          <div class="slide-up stagger-3">
            <div class="flex justify-between items-center mb-3">
              <label id="labelDuration" class="text-white/80 text-lg">Duration</label>
              <span id="durationDisplay" class="text-2xl font-bold glow-accent px-4 py-1 rounded-full glass">3:00</span>
            </div>
            <input type="range" id="durationSlider" min="60" max="600" value="180" step="30" class="w-full" oninput="updateDuration(this.value)">
          </div>

          <!-- Difficulty (accordion) -->
          <div class="slide-up stagger-4">
            <button id="difficultyAccordionBtn" class="glass-button accordion-btn py-4 rounded-2xl text-white flex items-center justify-between" onclick="toggleDifficultyAccordion()">
              <span id="labelDifficulty" class="font-semibold">Difficulty</span>
              <span class="text-white/70">â–¾</span>
            </button>
            <div id="difficultyAccordion" class="accordion-content mt-3">
              <div class="glass rounded-2xl p-4 flex flex-wrap gap-2">
                <button id="diff_easy" class="chip" onclick="setDifficulty('easy')">ğŸŸ¢ <span id="diffEasyText" class="text-white">Easy</span></button>
                <button id="diff_normal" class="chip" onclick="setDifficulty('normal')">ğŸŸ¡ <span id="diffNormalText" class="text-white">Normal</span></button>
                <button id="diff_hard" class="chip" onclick="setDifficulty('hard')">ğŸŸ  <span id="diffHardText" class="text-white">Hard</span></button>
                <button id="diff_insane" class="chip" onclick="setDifficulty('insane')">ğŸ”´ <span id="diffInsaneText" class="text-white">Very Hard</span></button>
              </div>
            </div>
          </div>

          <!-- Colors -->
          <div class="slide-up stagger-5">
            <label id="labelColors" class="text-white/80 text-lg block mb-4">Theme Colors</label>
            <div class="flex justify-center gap-8">
              <div class="text-center">
                <input type="color" id="primaryColor" value="#B3E5FC" class="mb-2" onchange="updatePrimaryColor(this.value)">
                <p id="labelPrimary" class="text-white/60 text-sm">Primary</p>
              </div>
              <div class="text-center">
                <input type="color" id="secondaryColor" value="#FFFFFF" class="mb-2" onchange="updateSecondaryColor(this.value)">
                <p id="labelSecondary" class="text-white/60 text-sm">Secondary</p>
              </div>
            </div>
          </div>
        </div>

        <button id="btnStart" class="glass-button w-full mt-8 py-5 rounded-2xl text-xl font-semibold text-white slide-up glow-primary" onclick="startGame()">
          â–¶ Start Game
        </button>

        <button id="btnOpenSettings" class="glass-button w-full mt-4 py-3 rounded-xl text-white/70 slide-up" onclick="openSettings()">
          âš™ï¸ Settings
        </button>
      </div>
    </div>

    <!-- Role Reveal Screen -->
    <div id="roleScreen" class="screen">
      <div class="text-center w-full max-w-md">
        <p id="playerLabel" class="text-2xl text-white/60 mb-4 slide-down">Player 1</p>

        <div id="roleCard" class="glass-card rounded-3xl p-8 md:p-12 cursor-pointer breathing" onclick="revealRole()">
          <div id="roleContent">
            <div id="tapPrompt" class="text-center">
              <div class="text-6xl mb-6">ğŸ‘†</div>
              <p id="tapText" class="text-xl text-white/80">Tap to see your role</p>
            </div>

            <div id="roleRevealed" class="hidden">
              <div id="roleIcon" class="text-8xl mb-6"></div>
              <p id="roleText" class="text-3xl font-bold text-white mb-4"></p>
              <p id="wordText" class="text-4xl font-bold text-white"></p>
            </div>
          </div>
        </div>

        <button id="btnConfirm" class="glass-button w-full mt-8 py-5 rounded-2xl text-xl font-semibold text-white hidden glow-primary" onclick="confirmRole()">
          Confirm & Pass
        </button>
      </div>
    </div>

    <!-- Game Timer Screen -->
    <div id="timerScreen" class="screen">
      <div class="text-center">
        <h2 id="discussTitle" class="text-3xl md:text-4xl font-bold text-white mb-8 slide-down" style="text-shadow: 0 0 30px var(--primary);">
          Discussion Time
        </h2>

        <div class="relative w-64 h-64 md:w-80 md:h-80 mx-auto scale-in">
          <svg class="w-full h-full" viewBox="0 0 160 160">
            <circle cx="80" cy="80" r="70" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
            <circle id="timerRing" class="timer-ring" cx="80" cy="80" r="70" fill="none" stroke="var(--primary)" stroke-width="8" stroke-linecap="round"/>
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span id="timerDisplay" class="text-6xl md:text-7xl font-bold text-white" style="text-shadow: 0 0 30px var(--primary);">3:00</span>
          </div>
        </div>

        <button id="btnEndDiscussion" class="glass-button w-full max-w-sm mt-8 py-4 rounded-2xl text-lg font-semibold text-white slide-up hidden" onclick="endDiscussion()">
          ğŸ—³ï¸ Start Voting
        </button>
      </div>
    </div>

    <!-- Voting Screen -->
    <div id="votingScreen" class="screen">
      <div class="w-full max-w-lg">
        <h2 id="voteTitle" class="text-3xl md:text-4xl font-bold text-white text-center mb-4 slide-down" style="text-shadow: 0 0 30px var(--primary);">
          Vote for the Spy
        </h2>
        <p id="voteSubtitle" class="text-white/60 text-center mb-8 slide-down">Who do you think is the spy?</p>

        <div id="votingGrid" class="grid grid-cols-2 gap-4 mb-8"></div>

        <button id="btnConfirmVote" class="glass-button w-full py-5 rounded-2xl text-xl font-semibold text-white glow-primary hidden" onclick="confirmVotes()">
          Confirm Votes
        </button>
      </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="screen">
      <div class="text-center w-full max-w-md">
        <div id="resultCard" class="glass-card rounded-3xl p-8 md:p-12 scale-in">
          <div id="resultIcon" class="text-8xl mb-6"></div>
          <h2 id="resultTitle" class="text-3xl md:text-4xl font-bold text-white mb-4"></h2>
          <p id="resultMessage" class="text-xl text-white/80 mb-6"></p>

          <div class="glass rounded-2xl p-4 mb-4">
            <p id="revealSpyLabel" class="text-white/60 text-sm mb-1">The Spies Were</p>
            <p id="revealSpy" class="text-2xl font-bold text-white"></p>
          </div>

          <div class="glass rounded-2xl p-4">
            <p id="revealWordLabel" class="text-white/60 text-sm mb-1">The Word Was</p>
            <p id="revealWord" class="text-2xl font-bold text-white"></p>
          </div>
        </div>

        <button id="btnPlayAgain" class="glass-button w-full mt-8 py-5 rounded-2xl text-xl font-semibold text-white glow-primary" onclick="playAgain()">
          ğŸ”„ Play Again
        </button>

        <button id="btnNewSetup" class="glass-button w-full mt-4 py-3 rounded-xl text-white/70" onclick="newSetup()">
          âš™ï¸ New Setup
        </button>
      </div>
    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NEW WORD BANK (generated to be large, non-weird)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const WORD_BANK_BASE = {
      en: {
        easy: [
          'Apple','Banana','Orange','Grapes','Watermelon','Strawberry','Peach','Cherry','Pineapple','Mango',
          'Car','Bicycle','Bus','Train','Airplane','Boat','Motorcycle','Taxi','Helmet','Backpack',
          'Hospital','School','Library','Airport','Restaurant','Hotel','Museum','Cinema','Stadium','Park',
          'Chair','Table','Sofa','Bed','Lamp','Mirror','Clock','Carpet','Curtain','Door',
          'Dog','Cat','Rabbit','Lion','Tiger','Bear','Fox','Wolf','Elephant','Deer'
        ],
        normal: [
          'Microwave','Refrigerator','Washing machine','Vacuum cleaner','Power bank','Smartphone','Headphones','Router','Printer','Scanner',
          'Traffic light','Pedestrian crossing','Parking lot','Bus stop','Train station','Ticket office','Reception desk','Security camera','Elevator','Escalator',
          'Dentist','Pharmacist','Architect','Photographer','Electrician','Mechanic','Journalist','Translator','Programmer','Designer'
        ],
        hard: [
          'Heat insulation','Seismic joint','Fire extinguisher','Circuit breaker','Water pressure','Air filter','Carbon monoxide','Emergency exit','First aid kit','Backup generator',
          'Ceramic tile','Bathroom tiles','Shopping bag','Toolbox','Wrench set','Screwdriver','Measuring tape','Level meter','Wall plug','Cable duct'
        ],
        insane: [
          'Acoustic insulation','Humidity barrier','Thermal conductivity','Load-bearing wall','Shear wall','Reinforced concrete','Steel reinforcement','Expansion joint','Waterproofing membrane','Ventilation duct',
          'Bathroom grout','Silicone sealant','Hand truck','Foldable ladder','Circuit diagram','Network topology','Compression fitting','Ball valve','Wall anchor','Gypsum board'
        ]
      },
      fa: {
        easy: [
          'Ø³ÛŒØ¨','Ù…ÙˆØ²','Ù¾Ø±ØªÙ‚Ø§Ù„','Ø§Ù†Ú¯ÙˆØ±','Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡','ØªÙˆØª ÙØ±Ù†Ú¯ÛŒ','Ù‡Ù„Ùˆ','Ú¯ÛŒÙ„Ø§Ø³','Ø¢Ù†Ø§Ù†Ø§Ø³','Ø§Ù†Ø¨Ù‡',
          'Ù…Ø§Ø´ÛŒÙ†','Ø¯ÙˆÚ†Ø±Ø®Ù‡','Ø§ØªÙˆØ¨ÙˆØ³','Ù‚Ø·Ø§Ø±','Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§','Ù‚Ø§ÛŒÙ‚','Ù…ÙˆØªÙˆØ±Ø³ÛŒÚ©Ù„Øª','ØªØ§Ú©Ø³ÛŒ','Ú©Ù„Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒ','Ú©ÙˆÙ„Ù‡ Ù¾Ø´ØªÛŒ',
          'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù†','Ù…Ø¯Ø±Ø³Ù‡','Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡','ÙØ±ÙˆØ¯Ú¯Ø§Ù‡','Ø±Ø³ØªÙˆØ±Ø§Ù†','Ù‡ØªÙ„','Ù…ÙˆØ²Ù‡','Ø³ÛŒÙ†Ù…Ø§','Ù¾Ø§Ø±Ú©','Ø§Ø³ØªØ§Ø¯ÛŒÙˆÙ…',
          'ØµÙ†Ø¯Ù„ÛŒ','Ù…ÛŒØ²','Ù…Ø¨Ù„','ØªØ®Øª','Ù„Ø§Ù…Ù¾','Ø¢ÛŒÙ†Ù‡','Ø³Ø§Ø¹Øª','ÙØ±Ø´','Ù¾Ø±Ø¯Ù‡','Ø¯Ø±',
          'Ø³Ú¯','Ú¯Ø±Ø¨Ù‡','Ø®Ø±Ú¯ÙˆØ´','Ø´ÛŒØ±','Ø¨Ø¨Ø±','Ø®Ø±Ø³','Ø±ÙˆØ¨Ø§Ù‡','Ú¯Ø±Ú¯','ÙÛŒÙ„','Ø¢Ù‡Ùˆ',
          'Ù†ÙˆØ²Ø§Ø¯','Ù…Ø§Ø¯Ø±','Ù¾Ø¯Ø±','Ø®ÙˆØ§Ù‡Ø±','Ø¨Ø±Ø§Ø¯Ø±','Ø¯ÙˆØ³Øª','Ù‡Ù…Ø³Ø§ÛŒÙ‡','Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²','Ù…Ø¹Ù„Ù…','Ù¾Ø²Ø´Ú©',
          'Ù†Ø§Ù†','Ø¨Ø±Ù†Ø¬','Ù…Ø§Ú©Ø§Ø±ÙˆÙ†ÛŒ','Ù¾Ù†ÛŒØ±','Ù…Ø§Ø³Øª','ØªØ®Ù… Ù…Ø±Øº','Ú†Ø§ÛŒ','Ù‚Ù‡ÙˆÙ‡','Ø¢Ø¨','Ø¢Ø¨Ù…ÛŒÙˆÙ‡',
          'Ú©ØªØ§Ø¨','Ø¯ÙØªØ±','Ø®ÙˆØ¯Ú©Ø§Ø±','Ù…Ø¯Ø§Ø¯','Ù¾Ø§Ú© Ú©Ù†','Ú©ÛŒÙ','Ú©ÙØ´','Ø¬ÙˆØ±Ø§Ø¨','Ú©Ù„Ø§Ù‡','Ù¾Ø§Ù„ØªÙˆ',
          'Ø¨Ø§Ø±Ø§Ù†','Ø¨Ø±Ù','Ø¨Ø§Ø¯','Ø¢ÙØªØ§Ø¨','Ø§Ø¨Ø±','Ø´Ø¨','ØµØ¨Ø­','Ø¸Ù‡Ø±','Ø¹ØµØ±','Ø¨Ù‡Ø§Ø±',
          'Ú©ÛŒÙ Ù¾ÙˆÙ„','Ú©Ù„ÛŒØ¯','Ù…ÙˆØ¨Ø§ÛŒÙ„','Ø´Ø§Ø±Ú˜Ø±','ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ†','ÛŒØ®Ú†Ø§Ù„','Ø§Ø¬Ø§Ù‚ Ú¯Ø§Ø²','Ù„ÛŒÙˆØ§Ù†','Ø¨Ø´Ù‚Ø§Ø¨','Ù‚Ø§Ø´Ù‚',
          'Ú¯Ù„Ø¯Ø§Ù†','Ú¯Ù„','Ø¯Ø±Ø®Øª',
          'Ø®ÛŒØ§Ø¨Ø§Ù†','Ú©ÙˆÚ†Ù‡','Ø®Ø§Ù†Ù‡','Ù¾Ù†Ø¬Ø±Ù‡','Ø¨Ø§Ù„Ú©Ù†','Ø­ÛŒØ§Ø·','Ù¾Ù„Ù‡',
          'ØªÙ‡Ø±Ø§Ù†','ØªØ¨Ø±ÛŒØ²','Ø§ØµÙÙ‡Ø§Ù†','Ø´ÛŒØ±Ø§Ø²','Ù…Ø´Ù‡Ø¯','Ø±Ø´Øª','Ø§Ù‡ÙˆØ§Ø²','Ú©Ø±Ù…Ø§Ù†','ÛŒØ²Ø¯','Ú©ÛŒØ´',
          'Ø§ÛŒØ±Ø§Ù†','ØªØ±Ú©ÛŒÙ‡','Ø¢Ù„Ù…Ø§Ù†','ÙØ±Ø§Ù†Ø³Ù‡','Ø§ÛŒØªØ§Ù„ÛŒØ§','Ø§Ø³Ù¾Ø§Ù†ÛŒØ§','Ø§Ù†Ú¯Ù„ÛŒØ³','Ø¢Ù…Ø±ÛŒÚ©Ø§','Ú˜Ø§Ù¾Ù†','Ú†ÛŒÙ†',
          'ÙÙˆØªØ¨Ø§Ù„','Ø¨Ø³Ú©ØªØ¨Ø§Ù„','ÙˆØ§Ù„ÛŒØ¨Ø§Ù„','ØªÙ†ÛŒØ³','Ø´Ù†Ø§','Ú©Ø´ØªÛŒ','Ø¯ÙˆÚ†Ø±Ø®Ù‡ Ø³ÙˆØ§Ø±ÛŒ','Ø¯Ùˆ Ù…ÛŒØ¯Ø§Ù†ÛŒ','Ø¨Ø¯Ù†Ø³Ø§Ø²ÛŒ','Ø´Ø·Ø±Ù†Ø¬',
          'Ø¹Ù„ÛŒ Ø¯Ø§ÛŒÛŒ','Ú©Ø±ÛŒØ³ØªÛŒØ§Ù†Ùˆ Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ','Ù„ÛŒÙˆÙ†Ù„ Ù…Ø³ÛŒ','Ù…Ø§ÛŒÚ©Ù„ Ø¬Ø±Ø¯Ù†','Ù…Ø­Ù…Ø¯ Ø¹Ù„ÛŒ Ú©Ù„ÛŒ','Ù…Ø§ÛŒÚ©Ù„ Ø¬Ú©Ø³ÙˆÙ†','Ø§Ù„ÙˆÛŒØ³ Ù¾Ø±ÛŒØ³Ù„ÛŒ','Ø¢Ù„Ø¨Ø±Øª Ø§ÛŒÙ†Ø´ØªÛŒÙ†','Ø§Ø³ØªÛŒÙˆ Ø¬Ø§Ø¨Ø²','Ø¨ÛŒÙ„ Ú¯ÛŒØªØ³',
          'ØªØ§Ù… Ùˆ Ø¬Ø±ÛŒ','Ù…Ø±Ø¯ Ø¹Ù†Ú©Ø¨ÙˆØªÛŒ','Ø¨ØªÙ…Ù†','Ø³ÙˆÙ¾Ø±Ù…Ù†','Ù‡Ø±ÛŒ Ù¾Ø§ØªØ±','Ø§Ø±Ø¨Ø§Ø¨ Ø­Ù„Ù‚Ù‡ Ù‡Ø§','Ø¬Ù†Ú¯ Ø³ØªØ§Ø±Ú¯Ø§Ù†','Ù¾Ø§Ù†Ø¯Ø§ÛŒ Ú©ÙˆÙ†Ú¯ ÙÙˆ Ú©Ø§Ø±','Ø´ÛŒØ±Ø´Ø§Ù‡','ÛŒØ® Ø²Ø¯Ù‡',
          'Ú¯ÛŒØªØ§Ø±','Ù¾ÛŒØ§Ù†Ùˆ','ÙˆÛŒÙˆÙ„Ù†','Ø¯Ø±Ø§Ù…','Ø³Ù†ØªÙˆØ±','ØªØ§Ø±','Ø³Ù‡ ØªØ§Ø±','Ø¯Ù','Ù†ÛŒ','Ú©ÛŒØ¨ÙˆØ±Ø¯',
          'Ù¾Ù„ÛŒØ³','Ø¢ØªØ´ Ù†Ø´Ø§Ù†','Ø®Ù„Ø¨Ø§Ù†','Ø±Ø§Ù†Ù†Ø¯Ù‡','Ø¢Ø´Ù¾Ø²','Ù†Ù‚Ø§Ø´','ÙˆØ±Ø²Ø´Ú©Ø§Ø±','Ø®ÙˆØ§Ù†Ù†Ø¯Ù‡','Ø¨Ø§Ø²ÛŒÚ¯Ø±','Ú©Ø§Ø±Ø¢ÙØ±ÛŒÙ†'
        ],
        normal: [
          'Ù…Ø§ÛŒÚ©Ø±ÙˆÙˆÛŒÙˆ','ÛŒØ®Ú†Ø§Ù„','Ù…Ø§Ø´ÛŒÙ† Ù„Ø¨Ø§Ø³Ø´ÙˆÛŒÛŒ','Ø¬Ø§Ø±ÙˆØ¨Ø±Ù‚ÛŒ','Ù¾Ø§ÙˆØ±Ø¨Ø§Ù†Ú©','Ú¯ÙˆØ´ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯','Ù‡Ø¯ÙÙˆÙ†','Ø±ÙˆØªØ±','Ù¾Ø±ÛŒÙ†ØªØ±','Ø§Ø³Ú©Ù†Ø±',
          'Ú†Ø±Ø§Øº Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ','Ø®Ø· Ø¹Ø§Ø¨Ø± Ù¾ÛŒØ§Ø¯Ù‡','Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯','Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ø§ØªÙˆØ¨ÙˆØ³','Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ù‚Ø·Ø§Ø±','Ø¨Ù„ÛŒØª ÙØ±ÙˆØ´ÛŒ','Ù¾Ø°ÛŒØ±Ø´','Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø¯Ø§Ø±Ø¨Ø³ØªÙ‡','Ø¢Ø³Ø§Ù†Ø³ÙˆØ±','Ù¾Ù„Ù‡ Ø¨Ø±Ù‚ÛŒ',
          'Ø¯Ù†Ø¯Ø§Ù†Ù¾Ø²Ø´Ú©','Ø¯Ø§Ø±ÙˆØ³Ø§Ø²','Ù…Ø¹Ù…Ø§Ø±','Ø¹Ú©Ø§Ø³','Ø¨Ø±Ù‚Ú©Ø§Ø±','Ù…Ú©Ø§Ù†ÛŒÚ©','Ø®Ø¨Ø±Ù†Ú¯Ø§Ø±','Ù…ØªØ±Ø¬Ù…','Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³','Ø·Ø±Ø§Ø­',
          'Ù…Ø§Ø´ÛŒÙ† Ø¸Ø±ÙØ´ÙˆÛŒÛŒ','ØªÙˆØ³ØªØ±','Ú©ØªØ±ÛŒ Ø¨Ø±Ù‚ÛŒ','Ù…Ø®Ù„ÙˆØ· Ú©Ù†','Ú†Ø±Ø® Ú¯ÙˆØ´Øª','Ù‚Ù‡ÙˆÙ‡ Ø³Ø§Ø²','Ø³Ø´ÙˆØ§Ø±','Ø§ØªÙˆ','Ù¾Ù†Ú©Ù‡','Ø¨Ø®Ø§Ø±ÛŒ Ø¨Ø±Ù‚ÛŒ',
          'Ú©Ù†ØªØ±Ù„ ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ†','Ù…ÙˆØ¯Ù… Ø§ÛŒÙ†ØªØ±Ù†Øª','Ú©Ø§Ø¨Ù„ Ø´Ø§Ø±Ú˜','ÙÙ„Ø´ Ù…Ù…ÙˆØ±ÛŒ','Ù‡Ø§Ø±Ø¯ Ø§Ú©Ø³ØªØ±Ù†Ø§Ù„','Ú©ÛŒØ¨ÙˆØ±Ø¯','Ù…Ø§ÙˆØ³','Ø§Ø³Ù¾ÛŒÚ©Ø±','Ù¾Ø±ÙˆÚ˜Ú©ØªÙˆØ±','Ù¾Ø§ÙˆØ± Ø³Ù‡ Ø±Ø§Ù‡ÛŒ',
          'Ú©Ø§Ø±Øª Ø¨Ø§Ù†Ú©ÛŒ','Ø±Ù…Ø² Ù¾ÙˆÛŒØ§','Ø¹Ø§Ø¨Ø± Ø¨Ø§Ù†Ú©','ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø²Ù†Ø¬ÛŒØ±Ù‡ Ø§ÛŒ','Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª','Ù†Ø§Ù†ÙˆØ§ÛŒÛŒ','Ù‚ØµØ§Ø¨ÛŒ','Ù…ÛŒÙˆÙ‡ ÙØ±ÙˆØ´ÛŒ','Ø¯Ø§Ø±ÙˆØ®Ø§Ù†Ù‡','Ù¾Ø³Øª',
          'Ù¾Ù…Ù¾ Ø¨Ø§Ø¯','Ø¬Ú© Ù…Ø§Ø´ÛŒÙ†','Ø¢Ú†Ø§Ø± Ú†Ø±Ø®','Ú†Ø±Ø§Øº Ù‚ÙˆÙ‡','Ú†Ø§Ù‚ÙˆÛŒ Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡','ØªØ®ØªÙ‡ Ú¯ÙˆØ´Øª','Ù‚Ø§Ø¨Ù„Ù…Ù‡','Ù…Ø§Ù‡ÛŒØªØ§Ø¨Ù‡','ÙÙ„Ø§Ø³Ú©','Ù‚Ù…Ù‚Ù…Ù‡',
          'Ø±ÛŒÙ…Ù„','Ø¹Ø·Ø±','Ú©Ø±Ù… Ø¶Ø¯Ø¢ÙØªØ§Ø¨','ØªÛŒØº Ø§ØµÙ„Ø§Ø­','Ù…Ø³ÙˆØ§Ú©','Ø®Ù…ÛŒØ± Ø¯Ù†Ø¯Ø§Ù†','Ø´Ø§Ù…Ù¾Ùˆ','ØµØ§Ø¨ÙˆÙ†','Ø¯Ø³ØªÙ…Ø§Ù„ Ú©Ø§ØºØ°ÛŒ','Ù…Ø§ÛŒØ¹ Ø¸Ø±ÙØ´ÙˆÛŒÛŒ',
          'Ø¯Ø³ØªÚ©Ø´ Ø¸Ø±ÙØ´ÙˆÛŒÛŒ','Ú©ÛŒØ³Ù‡ Ø²Ø¨Ø§Ù„Ù‡','Ø³Ø·Ù„ Ø²Ø¨Ø§Ù„Ù‡','Ø¬Ø§ Ú©Ù„ÛŒØ¯ÛŒ','Ù‚ÙÙ„','Ø²Ù†Ú¯ Ø¯Ø±','Ú†Ø´Ù…ÛŒ Ø¯Ø±','Ù¾Ø§Ø¯Ø±ÛŒ','Ø¢ÙˆÛŒØ² Ù„Ø¨Ø§Ø³','Ú†ÙˆØ¨ Ù„Ø¨Ø§Ø³ÛŒ',
          'Ù‚Ø§Ø¨ Ú¯ÙˆØ´ÛŒ','Ú¯Ù„Ø³ Ú¯ÙˆØ´ÛŒ','Ú©ÛŒÙ Ù„Ù¾ ØªØ§Ù¾','Ú©ÙˆÙ„Ù‡ Ù…Ø¯Ø±Ø³Ù‡','Ø¬Ø§Ù…Ø¯Ø§Ø¯ÛŒ','Ù…Ù†Ú¯Ù†Ù‡','Ú†Ø³Ø¨ Ù†ÙˆØ§Ø±ÛŒ','Ù‚ÛŒÚ†ÛŒ','Ø®Ø· Ú©Ø´',
          'Ú©Ø§ØºØ° A4',
          'Ù…ØªØ±Ùˆ','ØªØ±Ù…ÛŒÙ†Ø§Ù„','Ù¾Ù…Ù¾ Ø¨Ù†Ø²ÛŒÙ†','Ù¾Ø§Ø³Ø§Ú˜','Ù†Ù…Ø§ÛŒØ´Ú¯Ø§Ù‡','Ø³Ø§Ù„Ù† ÙˆØ±Ø²Ø´ÛŒ','Ø§Ø³ØªØ®Ø±','ÙÙˆØ¯Ú©ÙˆØ±Øª','Ø´Ù‡Ø±Ø¨Ø§Ø²ÛŒ','Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ù¾Ù„ÛŒØ³',
          'Ù¾Ø±Ø³Ù¾ÙˆÙ„ÛŒØ³','Ø§Ø³ØªÙ‚Ù„Ø§Ù„','ØªØ±Ø§Ú©ØªÙˆØ±','Ø¨Ø§Ø±Ø³Ù„ÙˆÙ†Ø§','Ø±Ø¦Ø§Ù„ Ù…Ø§Ø¯Ø±ÛŒØ¯','Ù…Ù†Ú†Ø³ØªØ± ÛŒÙˆÙ†Ø§ÛŒØªØ¯','Ù„ÛŒÙˆØ±Ù¾ÙˆÙ„','Ø¨Ø§ÛŒØ±Ù† Ù…ÙˆÙ†ÛŒØ®','ÛŒÙˆÙˆÙ†ØªÙˆØ³','Ù…ÛŒÙ„Ø§Ù†',
          'Ø¬Ø§Ù… Ø¬Ù‡Ø§Ù†ÛŒ','Ù„ÛŒÚ¯ Ù‚Ù‡Ø±Ù…Ø§Ù†Ø§Ù† Ø§Ø±ÙˆÙ¾Ø§','Ø§Ù„Ù…Ù¾ÛŒÚ©','Ø¬Ø§Ù… Ù…Ù„Øª Ù‡Ø§ÛŒ Ø¢Ø³ÛŒØ§','Ù„ÛŒÚ¯ Ø¨Ø±ØªØ±','Ø¬Ø§Ù… Ø­Ø°ÙÛŒ','Ø¯Ø±Ø¨ÛŒ','ÙÛŒÙ†Ø§Ù„','ÙˆÙ‚Øª Ø§Ø¶Ø§ÙÙ‡','Ù¾Ù†Ø§Ù„ØªÛŒ',
          'Ø¢Ù¾Ø¯ÛŒØª Ù†Ø±Ù… Ø§ÙØ²Ø§Ø±','Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ','Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±','Ø§Ø«Ø± Ø§Ù†Ú¯Ø´Øª','ØªØ´Ø®ÛŒØµ Ú†Ù‡Ø±Ù‡','Ø¨Ù„ÙˆØªÙˆØ«','GPS','Ù‡Ø§Øª Ø§Ø³Ù¾Ø§Øª','Ø´Ø§Ø±Ú˜ Ø³Ø±ÛŒØ¹','Ø­Ø§Ù„Øª Ù¾Ø±ÙˆØ§Ø²',
          'Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…','ØªÙ„Ú¯Ø±Ø§Ù…','ÙˆØ§ØªØ³Ø§Ù¾','ÛŒÙˆØªÛŒÙˆØ¨','ØªÙˆÛŒÛŒØªØ±','ØªÛŒÚ© ØªØ§Ú©','Ù„ÛŒÙ†Ú©Ø¯ÛŒÙ†','Ø§Ø³Ù†Ù¾ Ú†Øª','Ø¢Ù¾Ø§Ø±Ø§Øª','Ø¯ÛŒÙˆØ§Ø±',
          'Ù¾Ø§Ø³Ù¾ÙˆØ±Øª','ÙˆÛŒØ²Ø§','Ú†Ù…Ø¯Ø§Ù†','Ú¯ÛŒØª Ù¾Ø±ÙˆØ§Ø²','ØªØ±Ø§Ù†Ø²ÛŒØª','Ø±Ø²Ø±Ùˆ Ù‡ØªÙ„','ØªÙˆØ± Ú¯Ø±Ø¯Ø´Ú¯Ø±ÛŒ','Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³ÙØ±','Ù†Ù‚Ø´Ù‡ Ø´Ù‡Ø±','Ú©Ø§Ø±Øª Ù¾Ø±ÙˆØ§Ø²',
          'Ù¾ÛŒØªØ²Ø§','Ù‡Ù…Ø¨Ø±Ú¯Ø±','ÙÙ„Ø§ÙÙ„','Ú©Ø¨Ø§Ø¨','Ù‚Ø±Ù…Ù‡ Ø³Ø¨Ø²ÛŒ','Ù‚ÛŒÙ…Ù‡','Ø¢Ø´ Ø±Ø´ØªÙ‡','Ù…ÛŒØ±Ø²Ø§ Ù‚Ø§Ø³Ù…ÛŒ','Ø¬ÙˆØ¬Ù‡ Ú©Ø¨Ø§Ø¨','Ø¨Ø³ØªÙ†ÛŒ',
          'Ø¯Ø§ÙˆØ±','Ú©Ø§Ù¾ÛŒØªØ§Ù†','Ù…Ø±Ø¨ÛŒ','Ù‡ÙˆØ§Ø¯Ø§Ø±','Ú¯Ø²Ø§Ø±Ø´Ú¯Ø±','Ø¨Ø§Ø²ÛŒÚ©Ù† Ø°Ø®ÛŒØ±Ù‡','ØªØ¯Ø§Ø±Ú©Ø§Øª','Ù¾Ø²Ø´Ú© ØªÛŒÙ…','Ù…Ø¯ÛŒØ±Ø¹Ø§Ù…Ù„','Ø³Ø®Ù†Ú¯Ùˆ'
        ],
        hard: [
          'Ù‚ÙÙ„ Ø¯Ø±','Ú©Ù„ÛŒØ¯ ÛŒØ¯Ú©','Ø²Ù†Ø¬ÛŒØ± Ø¯Ø±','Ú†Ø´Ù…ÛŒ Ø¯Ø±','Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ Ø¯Ø±','Ø¯Ø±Ø¨ Ø¶Ø¯ Ø³Ø±Ù‚Øª','Ù¾Ø§Ø¯Ø±ÛŒ','Ø¢ÙˆÛŒØ² Ù„Ø¨Ø§Ø³','Ú†ÙˆØ¨ Ù„Ø¨Ø§Ø³ÛŒ','Ú©Ù…Ø¯ Ø¯ÛŒÙˆØ§Ø±ÛŒ',
          'Ø±ÛŒÙ„ Ú©Ø´Ùˆ','Ù„ÙˆÙ„Ø§ÛŒ Ú©Ø§Ø¨ÛŒÙ†Øª','Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ Ú©Ø§Ø¨ÛŒÙ†Øª','Ø¬Ø§ Ø§Ø¯ÙˆÛŒÙ‡','Ø¬Ø§ Ù‚Ø§Ø´Ù‚ÛŒ','Ø¬Ø§ÛŒ Ø¯Ø³ØªÙ…Ø§Ù„','Ø¬Ø§ ØµØ§Ø¨ÙˆÙ†ÛŒ','Ø¬Ø§ Ù…Ø³ÙˆØ§Ú©ÛŒ','Ù¾Ù…Ù¾ Ù…Ø§ÛŒØ¹','Ø§Ø³Ú©Ø§Ú†',
          'Ø³Ø·Ù„ Ø¨Ø§Ø²ÛŒØ§ÙØª','Ú©ÛŒØ³Ù‡ Ø²Ø¨Ø§Ù„Ù‡','Ø¬Ø¹Ø¨Ù‡ Ù†Ø¸Ù… Ø¯Ù‡Ù†Ø¯Ù‡','Ù‚ÙØ³Ù‡','Ú©Ø´Ùˆ','Ø¬Ø§Ú©ÙØ´ÛŒ','Ø¬Ø§Ø±Ùˆ Ø´Ø§Ø±Ú˜ÛŒ','Ø¯Ø³ØªÙ…Ø§Ù„ Ù…ÛŒÚ©Ø±ÙˆÙØ§ÛŒØ¨Ø±','ØªÛŒ Ø¢Ø¨Ú¯ÛŒØ±','Ø³Ø·Ù„ Ø¢Ø¨',
          'Ù¾ÛŒÚ† Ú¯ÙˆØ´ØªÛŒ','Ø§Ù†Ø¨Ø±Ø¯Ø³Øª','Ø¢Ú†Ø§Ø± ÙØ±Ø§Ù†Ø³Ù‡','Ú†Ú©Ø´','Ù…ØªØ±','ØªØ±Ø§Ø²','Ú©Ø§ØªØ±','Ù‚ÛŒÚ†ÛŒ','Ú†Ø³Ø¨ Ø¨Ø±Ù‚','Ù†ÙˆØ§Ø± Ú†Ø³Ø¨',
          'Ù…ÛŒØ®','Ù¾ÛŒÚ†','Ù…ØªÙ‡','Ø¯Ø±ÛŒÙ„','Ù†Ø±Ø¯Ø¨Ø§Ù†','Ú†Ø±Ø§Øº Ù‚ÙˆÙ‡','Ø¨Ø§ØªØ±ÛŒ Ù‚Ù„Ù…ÛŒ','Ù…Ø­Ø§ÙØ¸ Ø¨Ø±Ù‚','Ø³Ù‡ Ø±Ø§Ù‡ÛŒ Ø¨Ø±Ù‚','Ú©Ø§Ø¨Ù„ Ø´Ø§Ø±Ú˜',
          'Ù‚Ø§Ø¨Ù„Ù…Ù‡ Ø²ÙˆØ¯Ù¾Ø²','Ø²ÙˆØ¯Ù¾Ø² Ø¨Ø±Ù‚ÛŒ','Ù…Ø§Ù‡ÛŒ ØªØ§Ø¨Ù‡ Ú¯Ø±ÛŒÙ„','ØµØ§ÙÛŒ','Ø§Ù„Ú©','ØªØ±Ø§Ø²Ùˆ Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡','Ø±Ù†Ø¯Ù‡','Ù‡Ù…Ø²Ù† Ø¯Ø³ØªÛŒ','Ù‚Ù‡ÙˆÙ‡ Ø³Ø§Ø²','ÙØ± ØªÙˆÚ©Ø§Ø±',
          'ØªØ±Ø´ÛŒ','Ø´ÙˆØ±','Ù„ÙˆØ§Ø´Ú©','Ø±Ø¨ Ø§Ù†Ø§Ø±','Ø²Ø¹ÙØ±Ø§Ù†','Ù‡Ù„','Ø¯Ø§Ø±Ú†ÛŒÙ†','Ø²ÛŒØ±Ù‡','Ú¯Ù„Ø§Ø¨','Ø¹Ø±Ù‚ Ù†Ø¹Ù†Ø§Ø¹',
          'Ú©Ø§Ø±Øª Ù¾Ø±ÙˆØ§Ø²','Ú¯ÛŒØª Ù¾Ø±ÙˆØ§Ø²','Ú†Ù…Ø¯Ø§Ù† Ø¯Ø³ØªÛŒ','Ù‡ØªÙ„ Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù†','Ø§Ù‚Ø§Ù…ØªÚ¯Ø§Ù‡ Ø¨ÙˆÙ…Ú¯Ø±Ø¯ÛŒ','Ù†Ù‚Ø´Ù‡ Ù…ØªØ±Ùˆ','Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ ØªØ§Ú©Ø³ÛŒ','Ø¹ÙˆØ§Ø±Ø¶ÛŒ','ØªØ§Ø¨Ù„Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§','Ú©Ø¯ Ù¾Ø³ØªÛŒ',
          'ÙˆÙ‚Øª Ø§Ø¶Ø§ÙÙ‡','Ù¾Ù†Ø§Ù„ØªÛŒ','Ú©Ø§Ù¾ÛŒØªØ§Ù†','Ú©Ø§Ø±Øª Ø²Ø±Ø¯','Ú©Ø§Ø±Øª Ù‚Ø±Ù…Ø²','Ø³ÙˆØª Ø¯Ø§ÙˆØ±','ØªÙ…Ø±ÛŒÙ†','Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø¯ÙˆØ³ØªØ§Ù†Ù‡','ÙÛŒÙ†Ø§Ù„','Ù‡ÙˆØ§Ø¯Ø§Ø±'
        ],
        insane: [
          'Ù†ÙˆØ§Ø± Ø¯Ø±Ø²Ú¯ÛŒØ±','Ú†Ø³Ø¨ Ø³ÛŒÙ„ÛŒÚ©ÙˆÙ†','Ø¯Ø±Ø²Ú¯ÛŒØ± Ù¾Ù†Ø¬Ø±Ù‡','ØªÙˆØ±ÛŒ Ù¾Ù†Ø¬Ø±Ù‡','Ù‚ÙÙ„ Ù¾Ù†Ø¬Ø±Ù‡','Ø³Ø±Ø´ÛŒØ± Ø¢Ø¨','Ø´ÛŒÙ„Ù†Ú¯ Ø¢Ø¨','Ø´Ù„Ù†Ú¯ Ú¯Ø§Ø²','ÙÛŒÙ„ØªØ± Ø¢Ø¨','Ø¯ÙˆØ´ Ø­Ù…Ø§Ù…',
          'Ú©Ø§ÙˆØ± Ù…Ø¨Ù„','Ø±ÙˆÚ©Ø´ ØµÙ†Ø¯Ù„ÛŒ','Ú©Ø§ÙˆØ± ØªØ´Ú©','Ø±ÙˆØªØ®ØªÛŒ','Ø±ÙˆØ¨Ø§Ù„Ø´ÛŒ','Ù¾ØªÙˆ Ù…Ø³Ø§ÙØ±ØªÛŒ','Ù¾Ø±Ø¯Ù‡ Ú©Ø±Ú©Ø±Ù‡','Ù…ÛŒÙ„Ù‡ Ù¾Ø±Ø¯Ù‡','Ù‚Ø±Ù†ÛŒØ²','Ú©ÙÙ¾ÙˆØ´ Ù¾Ø§Ø±Ú©Øª',
          'Ú©Ø§Ø±Øª Ø­Ø§ÙØ¸Ù‡','Ù‡Ø§Ø±Ø¯ Ø§Ú©Ø³ØªØ±Ù†Ø§Ù„','Ú©Ø§Ø¨Ù„ HDMI','Ú©Ø§Ø¨Ù„ Ø´Ø¨Ú©Ù‡','Ù…ÙˆØ¯Ù… Ø§ÛŒÙ†ØªØ±Ù†Øª','Ø±ÙˆØªØ±','Ù¾Ø§ÙˆØ±Ø¨Ø§Ù†Ú©','Ø´Ø§Ø±Ú˜Ø± ÙÙ†Ø¯Ú©ÛŒ','Ù‡Ù†Ø¯Ø²ÙØ±ÛŒ','Ù‡Ø¯ÙÙˆÙ† Ø¨ÛŒ Ø³ÛŒÙ…',
          'Ù¾Ø§ÛŒÙ‡ Ú¯ÙˆØ´ÛŒ','Ù¾Ø§ÛŒÙ‡ Ù„Ù¾ ØªØ§Ù¾','Ù‚ÙÙ„ Ø¯ÙˆÚ†Ø±Ø®Ù‡','Ú©Ù„Ø§Ù‡ Ø§ÛŒÙ…Ù†ÛŒ','Ú†Ø±Ø§Øº Ø¹Ù‚Ø¨ Ø¯ÙˆÚ†Ø±Ø®Ù‡','Ù¾Ù…Ù¾ Ø¨Ø§Ø¯','Ø¬Ú© Ù…Ø§Ø´ÛŒÙ†','Ø¢Ú†Ø§Ø± Ú†Ø±Ø®','Ø²Ø§Ù¾Ø§Ø³','Ù…Ø«Ù„Ø« Ø®Ø·Ø±',
          'Ø³Ø§Ú© Ø¯Ø³ØªÛŒ','Ú©ÛŒØ³Ù‡ ÙØ±ÛŒØ²Ø±','Ú©ÛŒØ³Ù‡ Ø²ÛŒÙ¾ Ø¯Ø§Ø±','Ø¸Ø±Ù Ø¯Ø±Ø¨ Ø¯Ø§Ø±','Ù‚Ù…Ù‚Ù…Ù‡','ÙÙ„Ø§Ø³Ú©','Ù¾ÙˆØ¯Ø± Ú©ÛŒÚ©','Ø¨Ú©ÛŒÙ†Ú¯ Ù¾ÙˆØ¯Ø±','ÙˆØ§Ù†ÛŒÙ„','Ù¾ÙˆØ¯Ø± Ú©Ø§Ú©Ø§Ø¦Ùˆ',
          'Ø®Ø§Ù…Ù‡ ØµØ¨Ø­Ø§Ù†Ù‡','Ù¾Ù†ÛŒØ± Ø®Ø§Ù…Ù‡ Ø§ÛŒ','Ø´ÛŒØ±Ø¹Ø³Ù„ÛŒ','Ø³Ø³ Ù…Ø§ÛŒÙˆÙ†Ø²','Ø³Ø³ Ú©Ú†Ø§Ù¾','Ø³Ø³ Ø®Ø±Ø¯Ù„','Ø²ÛŒØªÙˆÙ†','Ø®ÛŒØ§Ø±Ø´ÙˆØ±','Ú©Ù†Ø³Ø±Ùˆ Ù…Ø§Ù‡ÛŒ','ØªÙ† Ù…Ø§Ù‡ÛŒ',
          'Ù„ÛŒÚ¯ Ù‚Ù‡Ø±Ù…Ø§Ù†Ø§Ù† Ø§Ø±ÙˆÙ¾Ø§','Ø¬Ø§Ù… Ù…Ù„Øª Ù‡Ø§ÛŒ Ø¢Ø³ÛŒØ§','Ø§Ù„Ù…Ù¾ÛŒÚ©','Ø¬Ø§Ù… Ø¬Ù‡Ø§Ù†ÛŒ','Ù…Ø±Ø­Ù„Ù‡ Ú¯Ø±ÙˆÙ‡ÛŒ','ÛŒÚ© Ù‡Ø´ØªÙ… Ù†Ù‡Ø§ÛŒÛŒ','Ù†ÛŒÙ…Ù‡ Ù†Ù‡Ø§ÛŒÛŒ','ÙˆÙ‚Øª Ø§Ø³ØªØ±Ø§Ø­Øª','ØªØ³Ø§ÙˆÛŒ','Ú¯Ù„ Ø¨Ù‡ Ø®ÙˆØ¯ÛŒ',
          'Ø®Ø· ÙˆÛŒÚ˜Ù‡','Ø·Ø±Ø­ ØªØ±Ø§ÙÛŒÚ©','Ú†Ø±Ø§Øº Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ','Ù¾Ø§Ø±Ú© Ø­Ø§Ø´ÛŒÙ‡ Ø§ÛŒ','Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ø´Ø§Ø±Ú˜','Ú©Ø§Ø±Øª Ø¨Ù„ÛŒØª','Ú©Ø§Ø±ØªØ®ÙˆØ§Ù†','ØµÙ Ø§Ù†ØªØ¸Ø§Ø±','ØªØ§Ø¨Ù„Ùˆ Ø§Ø¹Ù„Ø§Ù†Ø§Øª','ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ'
        ]
      }
    };

    function expandWordBank() {
      // Deterministic-ish shuffle using a simple LCG
      const lcg = (seed) => () => (seed = (seed * 48271) % 0x7fffffff) / 0x7fffffff;
      const targets = { easy: 450, normal: 450, hard: 450, insane: 450 };

      const GEN = {
        en: {
          easy: {
            a: ['Red','Blue','Green','Small','Big','Sunny','Night','Morning','Hot','Cold'],
            b: ['ball','house','street','garden','window','cup','shirt','shoe','tree','book']
          },
          normal: {
            a: ['Electric','Digital','Portable','Wireless','Rechargeable','Foldable','Automatic','Smart','Compact','Heavy-duty'],
            b: ['kettle','speaker','keyboard','mouse','power strip','adapter','flashlight','tripod','stroller','tool bag']
          },
          hard: {
            a: ['Bathroom','Kitchen','Garage','Outdoor','Emergency','Electrical','Plumbing','Safety','Structural','Workshop'],
            b: ['sealant','valve','junction box','cable tray','pressure gauge','hose clamp','anchor bolt','safety relay','duct tape','shock absorber']
          },
          insane: {
            a: ['Reinforced','Load-bearing','Waterproof','Thermal','Acoustic','Seismic','Hydraulic','Ventilation','Fire-rated','Insulation'],
            b: ['membrane','composite','expansion joint','control panel','distribution board','conduit bend','compression fitting','shear connector','vapor barrier','structural bracket']
          }
        },
        fa: {
          easy: {
            a: ['Ù‚Ø±Ù…Ø²','Ø¢Ø¨ÛŒ','Ø³Ø¨Ø²','Ú©ÙˆÚ†Ú©','Ø¨Ø²Ø±Ú¯','ØµØ¨Ø­','Ø´Ø¨','Ú¯Ø±Ù…','Ø³Ø±Ø¯','Ù†Ùˆ'],
            b: ['ØªÙˆÙ¾','Ø®Ø§Ù†Ù‡','Ø®ÛŒØ§Ø¨Ø§Ù†','Ø¨Ø§Øº','Ù¾Ù†Ø¬Ø±Ù‡','Ù„ÛŒÙˆØ§Ù†','Ù¾ÛŒØ±Ø§Ù‡Ù†','Ú©ÙØ´','Ø¯Ø±Ø®Øª','Ú©ØªØ§Ø¨']
          },
          normal: {
            a: ['Ø¨Ø±Ù‚ÛŒ','Ø¯ÛŒØ¬ÛŒØªØ§Ù„','Ù‚Ø§Ø¨Ù„ Ø­Ù…Ù„','Ø¨ÛŒ Ø³ÛŒÙ…','Ø´Ø§Ø±Ú˜ÛŒ','ØªØ§Ø´Ùˆ','Ø®ÙˆØ¯Ú©Ø§Ø±','Ù‡ÙˆØ´Ù…Ù†Ø¯','Ø¬Ù…Ø¹ Ùˆ Ø¬ÙˆØ±','Ù…Ø­Ú©Ù…'],
            b: ['Ú©ØªØ±ÛŒ','Ø§Ø³Ù¾ÛŒÚ©Ø±','Ú©ÛŒØ¨ÙˆØ±Ø¯','Ù…Ø§ÙˆØ³','Ø³Ù‡ Ø±Ø§Ù‡ÛŒ Ø¨Ø±Ù‚','Ø¢Ø¯Ø§Ù¾ØªÙˆØ±','Ú†Ø±Ø§Øº Ù‚ÙˆÙ‡','Ø³Ù‡ Ù¾Ø§ÛŒÙ‡','Ú©Ø§Ù„Ø³Ú©Ù‡','Ú©ÛŒÙ Ø§Ø¨Ø²Ø§Ø±']
          },
          hard: {
            a: ['Ø­Ù…Ø§Ù…','Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡','Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯','ÙØ¶Ø§ÛŒ Ø¨Ø§Ø²','Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ','Ø¨Ø±Ù‚','Ù„ÙˆÙ„Ù‡ Ú©Ø´ÛŒ','Ø§ÛŒÙ…Ù†ÛŒ','Ø³Ø§Ø²Ù‡','Ú©Ø§Ø±Ú¯Ø§Ù‡'],
            b: ['Ú†Ø³Ø¨','Ø´ÛŒØ±','Ø¬Ø¹Ø¨Ù‡ ØªÙ‚Ø³ÛŒÙ…','Ø³ÛŒÙ†ÛŒ Ú©Ø§Ø¨Ù„','ÙØ´Ø§Ø±Ø³Ù†Ø¬','Ø¨Ø³Øª Ø´Ù„Ù†Ú¯','Ù¾ÛŒÚ† Ø±ÙˆÙ„ Ø¨ÙˆÙ„Øª','Ø±Ù„Ù‡ Ø§ÛŒÙ…Ù†ÛŒ','Ù†ÙˆØ§Ø± Ø¯Ø±Ø²Ú¯ÛŒØ±','Ú©Ù…Ú© ÙÙ†Ø±']
          },
          insane: {
            a: ['Ù…Ø³Ù„Ø­','Ø¨Ø§Ø±Ø¨Ø±','Ø¶Ø¯Ø¢Ø¨','Ø­Ø±Ø§Ø±ØªÛŒ','ØµÙˆØªÛŒ','Ù„Ø±Ø²Ù‡ Ø§ÛŒ','Ù‡ÛŒØ¯Ø±ÙˆÙ„ÛŒÚ©','ØªÙ‡ÙˆÛŒÙ‡','Ø¶Ø¯Ø­Ø±ÛŒÙ‚','Ø¹Ø§ÛŒÙ‚'],
            b: ['ØºØ´Ø§','Ú©Ø§Ù…Ù¾ÙˆØ²ÛŒØª','Ø¯Ø±Ø² Ø§Ù†Ø¨Ø³Ø§Ø·','ØªØ§Ø¨Ù„Ùˆ Ø¨Ø±Ù‚','Ø¬Ø¹Ø¨Ù‡ ÙÛŒÙˆØ²','Ø®Ù… Ù„ÙˆÙ„Ù‡','Ø§ØªØµØ§Ù„ ÙØ´Ø§Ø±ÛŒ','Ø§ØªØµØ§Ù„ Ø¨Ø±Ø´ÛŒ','Ù…Ø§Ù†Ø¹ Ø¨Ø®Ø§Ø±','Ø¨Ø±Ø§Ú©Øª Ø³Ø§Ø²Ù‡']
          }
        }
      };

      for (const lang of ['en','fa']) {
        for (const diff of ['easy','normal','hard','insane']) {
          // Keep Persian 'insane' bank curated (no auto-expansion) so counts match the hand-picked list
          if (lang === 'fa' && diff === 'insane') { continue; }
          const set = new Set(WORD_BANK_BASE[lang][diff]);
          const rnd = lcg((lang.charCodeAt(0) + lang.charCodeAt(1) + diff.length) * 1337);
          const {a,b} = GEN[lang][diff];
          // generate combos
          const combos = [];
          for (let i = 0; i < a.length; i++) {
            for (let j = 0; j < b.length; j++) {
              combos.push(lang === 'fa' ? `${b[j]} ${a[i]}` : `${a[i]} ${b[j]}`);
            }
          }
          // shuffle combos
          for (let i = combos.length - 1; i > 0; i--) {
            const j = Math.floor(rnd() * (i + 1));
            [combos[i], combos[j]] = [combos[j], combos[i]];
          }
          for (const w of combos) {
            if (set.size >= targets[diff]) break;
            set.add(w);
          }
          WORD_BANK_BASE[lang][diff] = Array.from(set);
        }
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TRANSLATIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const TRANSLATIONS = {
      en: {
        settings: 'Settings',
        language: 'Language',
        soundEffects: 'Sound Effects',
        vibration: 'Vibration',
        unusedWords: 'Unused Words',

        resetUsedBtn: 'â™»ï¸ Reset used words',
        resetUsedConfirm: 'Reset ALL used words history? Words may repeat again.',
        resetUsedDone: 'Used words reset âœ…',
        gameSetup: 'Game Setup',
        players: 'Players',
        spies: 'Spies',
        duration: 'Duration',
        difficulty: 'Difficulty',
        easy: 'Easy',
        normal: 'Normal',
        hard: 'Hard',
        insane: 'Very Hard',
        themeColors: 'Theme Colors',
        primary: 'Primary',
        secondary: 'Secondary',
        startGame: 'â–¶ Start Game',
        settingsBtn: 'âš™ï¸ Settings',

        player: 'Player',
        tapToSee: 'Tap to see your role',
        youAreNormal: 'You are a Citizen',
        youAreSpy: 'YOU ARE A SPY',
        hidden: '???',
        confirmPass: 'Confirm & Pass',
        discussionTime: 'Discussion Time',
        startVoting: 'ğŸ—³ï¸ Start Voting',
        voteForSpy: 'Vote for a Spy',
        whoIsSpy: 'Who do you think is a spy?',
        confirmVotes: 'Confirm Votes',
        playersFound: 'Players Found a Spy!',
        spyWins: 'The Spies Win!',
        spiesWere: 'The Spies Were',
        wordWas: 'The Word Was',
        playAgain: 'ğŸ”„ Play Again',
        newSetup: 'âš™ï¸ New Setup',
        selectAll: 'Everyone must vote!',
        noWordsLeft: 'No unused words left for this difficulty ğŸ˜¬',
        spiesLimit: 'Spies cannot be more than players - 1',

        stat_easy: 'Easy',
        stat_normal: 'Normal',
        stat_hard: 'Hard',
        stat_insane: 'Very Hard'
      },
      fa: {
        settings: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª',
        language: 'Ø²Ø¨Ø§Ù†',
        soundEffects: 'Ø§ÙÚ©Øª ØµÙˆØªÛŒ',
        vibration: 'Ù„Ø±Ø²Ø´',
        unusedWords: 'Ú©Ù„Ù…Ø§ØªÙ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡',

        resetUsedBtn: 'â™»ï¸ Ø±ÛŒØ³Øª Ú©Ù„Ù…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´Ø¯Ù‡',
        resetUsedConfirm: 'Ù…Ø·Ù…Ø¦Ù†ÛŒØŸ ØªØ§Ø±ÛŒØ®Ú†Ù‡Ù” Ú©Ù„Ù…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´Ù‡ Ùˆ Ù…Ù…Ú©Ù†Ù‡ Ú©Ù„Ù…Ø§Øª Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÚ©Ø±Ø§Ø± Ø¨Ø´Ù†.',
        resetUsedDone: 'Ú©Ù„Ù…Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ø±ÛŒØ³Øª Ø´Ø¯ âœ…',
        gameSetup: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ',
        players: 'ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†',
        spies: 'ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø§Ø³ÙˆØ³â€ŒÙ‡Ø§',
        duration: 'Ù…Ø¯Øª Ø²Ù…Ø§Ù†',
        difficulty: 'Ø¯Ø±Ø¬Ù‡ Ø³Ø®ØªÛŒ',
        easy: 'Ø±Ø§Ø­Øª',
        normal: 'Ù…Ø¹Ù…ÙˆÙ„ÛŒ',
        hard: 'Ø³Ø®Øª',
        insane: 'Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª',
        themeColors: 'Ø±Ù†Ú¯ Ù‡Ø§ÛŒ ØªÙ…',
        primary: 'Ø§ØµÙ„ÛŒ',
        secondary: 'ÙØ±Ø¹ÛŒ',
        startGame: 'â–¶ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ',
        settingsBtn: 'âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª',

        player: 'Ø¨Ø§Ø²ÛŒÚ©Ù†',
        tapToSee: 'Ù„Ù…Ø³ Ú©Ù†ÛŒØ¯ ØªØ§ Ù†Ù‚Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯',
        youAreNormal: 'Ø´Ù…Ø§ ÛŒÚ© Ø´Ù‡Ø±ÙˆÙ†Ø¯ Ù‡Ø³ØªÛŒØ¯',
        youAreSpy: 'Ø´Ù…Ø§ Ø¬Ø§Ø³ÙˆØ³ Ù‡Ø³ØªÛŒØ¯',
        hidden: 'ØŸØŸØŸ',
        confirmPass: 'ØªØ§ÛŒÛŒØ¯ Ùˆ Ø±Ø¯ Ú©Ø±Ø¯Ù†',
        discussionTime: 'Ø²Ù…Ø§Ù† Ø¨Ø­Ø«',
        startVoting: 'ğŸ—³ï¸ Ø´Ø±ÙˆØ¹ Ø±Ø§ÛŒ Ú¯ÛŒØ±ÛŒ',
        voteForSpy: 'Ø¨Ù‡ Ø¬Ø§Ø³ÙˆØ³ Ø±Ø§ÛŒ Ø¨Ø¯Ù‡ÛŒØ¯',
        whoIsSpy: 'ÙÚ©Ø± Ù…ÛŒ Ú©Ù†ÛŒØ¯ Ø¬Ø§Ø³ÙˆØ³ Ú©ÛŒØ³ØªØŸ',
        confirmVotes: 'ØªØ§ÛŒÛŒØ¯ Ø±Ø§ÛŒ Ù‡Ø§',
        playersFound: 'Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ÛŒÚ© Ø¬Ø§Ø³ÙˆØ³ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù†Ø¯!',
        spyWins: 'Ø¬Ø§Ø³ÙˆØ³â€ŒÙ‡Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù†Ø¯!',
        spiesWere: 'Ø¬Ø§Ø³ÙˆØ³â€ŒÙ‡Ø§ Ø¨ÙˆØ¯Ù†Ø¯',
        wordWas: 'Ú©Ù„Ù…Ù‡ Ø¨ÙˆØ¯',
        playAgain: 'ğŸ”„ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡',
        newSetup: 'âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¬Ø¯ÛŒØ¯',
        selectAll: 'Ù‡Ù…Ù‡ Ø¨Ø§ÛŒØ¯ Ø±Ø§ÛŒ Ø¨Ø¯Ù‡Ù†Ø¯!',
        noWordsLeft: 'Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø±Ø¬Ù‡ Ø³Ø®ØªÛŒ Ø¯ÛŒÚ¯Ù‡ Ú©Ù„Ù…Ù‡ Ø¯ÛŒØ¯Ù‡â€ŒÙ†Ø´Ø¯Ù‡ Ù†Ø¯Ø§Ø±ÛŒÙ… ğŸ˜¬',
        spiesLimit: 'ØªØ¹Ø¯Ø§Ø¯ Ø¬Ø§Ø³ÙˆØ³â€ŒÙ‡Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¨ÛŒØ´ØªØ± Ø§Ø² (Ø¨Ø§Ø²ÛŒÚ©Ù†â€ŒÙ‡Ø§ - Û±) Ø¨Ø§Ø´Ù‡',

        stat_easy: 'Ø±Ø§Ø­Øª',
        stat_normal: 'Ù…Ø¹Ù…ÙˆÙ„ÛŒ',
        stat_hard: 'Ø³Ø®Øª',
        stat_insane: 'Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª'
      }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GAME STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let gameState = {
      language: 'en',
      playersCount: 4,
      spyCount: 1,
      gameDuration: 180,
      difficulty: 'normal',
      primaryColor: '#B3E5FC',
      secondaryColor: '#FFFFFF',
      currentScreen: 'setup',
      currentPlayerIndex: 0,
      spyIndices: [],
      currentWord: '',
      votes: [],
      roleRevealed: false,
      timerInterval: null,
      timeRemaining: 180,
      sfxEnabled: true,
      hapticsEnabled: true
    };

    const STORAGE = {
      prefs: 'shadowops_prefs_v2',
      used: 'shadowops_used_words_v2'
    };

    // Global silent flag (used to prevent SFX/haptics during initialization)
    let silent = false;

    const defaultConfig = { game_title: 'Shadow Ops' };
    let config = { ...defaultConfig };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ELEMENT SDK INITIALIZATION (unchanged behavior)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          // No language screen title now, keep for compatibility
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['game_title', cfg.game_title || defaultConfig.game_title]
        ])
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FX: SOUND + HAPTICS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let audioCtx = null;
    let userGestureUnlocked = false;

    // Unlock audio/haptics after the first real user gesture (Chrome autoplay policy)
    function unlockGesturesOnce() {
      userGestureUnlocked = true;
      ensureAudio(true);
      // Do NOT auto-play here; keep SFX behavior identical to the old version:
      // sounds will trigger from the actual button/task handlers.
      removeUnlockListeners();
    }

    function removeUnlockListeners() {
      document.removeEventListener('pointerdown', unlockGesturesOnce);
      document.removeEventListener('touchstart', unlockGesturesOnce);
      document.removeEventListener('mousedown', unlockGesturesOnce);
      document.removeEventListener('keydown', unlockGesturesOnce);
    }

    document.addEventListener('pointerdown', unlockGesturesOnce, { passive: true });
    document.addEventListener('touchstart', unlockGesturesOnce, { passive: true });
    document.addEventListener('mousedown', unlockGesturesOnce, { passive: true });
    document.addEventListener('keydown', unlockGesturesOnce, { passive: true });

    function ensureAudio(force = false) {
      if (!userGestureUnlocked && !force) return;
      if (!audioCtx) {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (AC) audioCtx = new AC();
      }
      if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume().catch(() => {});
    }

    function playTone(freq, durMs, type = 'sine', gain = 0.06) {
      if (!gameState.sfxEnabled) return;
      ensureAudio();
      if (!audioCtx) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g);
      g.connect(audioCtx.destination);
      const now = audioCtx.currentTime;
      g.gain.setValueAtTime(gain, now);
      g.gain.exponentialRampToValueAtTime(0.0001, now + durMs / 1000);
      o.start(now);
      o.stop(now + durMs / 1000);
    }

    function playSfx(name) {
      if (!gameState.sfxEnabled) return;
      if (!userGestureUnlocked) return;
      // Distinct, simple signatures
      switch (name) {
        case 'tap': playTone(520, 70, 'triangle', 0.05); playTone(780, 60, 'sine', 0.03); break;
        case 'start': playTone(330, 90, 'sine', 0.05); playTone(660, 120, 'triangle', 0.05); break;
        case 'reveal': playTone(440, 80, 'sine', 0.05); playTone(880, 140, 'triangle', 0.04); break;
        case 'confirm': playTone(740, 90, 'triangle', 0.05); break;
        case 'danger': playTone(160, 140, 'sawtooth', 0.04); break;
        case 'tick': playTone(1100, 25, 'square', 0.025); break;
        case 'vote': playTone(600, 60, 'triangle', 0.05); break;
        case 'win': playTone(523, 90, 'sine', 0.05); playTone(659, 90, 'sine', 0.05); playTone(784, 140, 'triangle', 0.04); break;
        case 'lose': playTone(220, 140, 'sawtooth', 0.04); playTone(180, 180, 'sine', 0.03); break;
        default: playTone(500, 60, 'triangle', 0.04);
      }
    }

    function vibrate(pattern) {
      if (!gameState.hapticsEnabled) return;
      if (!userGestureUnlocked) return;
      if (navigator.vibrate) navigator.vibrate(pattern);
    }

    function haptic(name) {
      // "Ù„Ø±Ø²Ø´ Ù‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚" Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ³Ú©
      switch (name) {
        case 'tap': vibrate(12); break;
        case 'start': vibrate([18, 20, 28]); break;
        case 'reveal': vibrate([12, 18, 12, 18, 24]); break;
        case 'spy': vibrate([30, 20, 30, 20, 60]); break;
        case 'confirm': vibrate([14, 18, 14]); break;
        case 'vote': vibrate([10, 14, 10]); break;
        case 'tick': vibrate(8); break;
        case 'danger': vibrate([20, 18, 20, 18, 20]); break;
        case 'win': vibrate([12, 18, 12, 18, 12]); break;
        case 'lose': vibrate([35, 20, 35]); break;
        default: vibrate(10);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOCAL STORAGE: prefs + used words (never reuse)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function loadPrefs() {
      try {
        const raw = localStorage.getItem(STORAGE.prefs);
        if (!raw) return;
        const p = JSON.parse(raw);
        if (p.language) gameState.language = p.language;
        if (p.playersCount) gameState.playersCount = p.playersCount;
        if (p.spyCount) gameState.spyCount = p.spyCount;
        if (p.gameDuration) gameState.gameDuration = p.gameDuration;
        if (p.difficulty) gameState.difficulty = p.difficulty;
        if (p.primaryColor) gameState.primaryColor = p.primaryColor;
        if (p.secondaryColor) gameState.secondaryColor = p.secondaryColor;
        if (typeof p.sfxEnabled === 'boolean') gameState.sfxEnabled = p.sfxEnabled;
        if (typeof p.hapticsEnabled === 'boolean') gameState.hapticsEnabled = p.hapticsEnabled;
      } catch (e) {}
    }

    function savePrefs() {
      try {
        localStorage.setItem(STORAGE.prefs, JSON.stringify({
          language: gameState.language,
          playersCount: gameState.playersCount,
          spyCount: gameState.spyCount,
          gameDuration: gameState.gameDuration,
          difficulty: gameState.difficulty,
          primaryColor: gameState.primaryColor,
          secondaryColor: gameState.secondaryColor,
          sfxEnabled: gameState.sfxEnabled,
          hapticsEnabled: gameState.hapticsEnabled
        }));
      } catch (e) {}
    }

    function loadUsedWords() {
      try {
        const raw = localStorage.getItem(STORAGE.used);
        if (!raw) return { en: {easy:[],normal:[],hard:[],insane:[]}, fa: {easy:[],normal:[],hard:[],insane:[]} };
        const u = JSON.parse(raw);
        // Ensure shape
        for (const lang of ['en','fa']) {
          u[lang] = u[lang] || {};
          for (const d of ['easy','normal','hard','insane']) u[lang][d] = u[lang][d] || [];
        }
        return u;
      } catch (e) {
        return { en: {easy:[],normal:[],hard:[],insane:[]}, fa: {easy:[],normal:[],hard:[],insane:[]} };
      }
    }

    function saveUsedWords(used) {
      try { localStorage.setItem(STORAGE.used, JSON.stringify(used)); } catch (e) {}
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI Helpers
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showToast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 1800);
    }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      setTimeout(() => document.getElementById(screenId).classList.add('active'), 50);
      gameState.currentScreen = screenId.replace('Screen','');
    }

    function openSettings() {
      playSfx('tap');
      haptic('tap');
      document.getElementById('settingsBackdrop').classList.add('active');
      document.getElementById('settingsModal').classList.add('active');
      syncSettingsUI();
      renderDifficultyStats();
    }

    function closeSettings() {
      playSfx('tap');
      haptic('tap');
      document.getElementById('settingsBackdrop').classList.remove('active');
      document.getElementById('settingsModal').classList.remove('active');
      savePrefs();
    }

    function toggleSfx() {
      gameState.sfxEnabled = !gameState.sfxEnabled;
      syncSettingsUI();
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function toggleHaptics() {
      gameState.hapticsEnabled = !gameState.hapticsEnabled;
      syncSettingsUI();
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }


    function resetUsedWords() {
      const t = TRANSLATIONS[gameState.language];
      // Require a user gesture anyway; this is called via button click
      playSfx('tap');
      haptic('tap');

      const ok = window.confirm(t.resetUsedConfirm);
      if (!ok) return;

      const empty = { en: {easy:[],normal:[],hard:[],insane:[]}, fa: {easy:[],normal:[],hard:[],insane:[]} };
      saveUsedWords(empty);
      showToast(t.resetUsedDone);
      renderDifficultyStats();
    }

    function syncSettingsUI() {
      const t = TRANSLATIONS[gameState.language];
      document.getElementById('settingsTitle').textContent = t.settings;
      document.getElementById('settingsLangLabel').textContent = t.language;
      document.getElementById('settingsSfxLabel').textContent = t.soundEffects;
      document.getElementById('settingsHapticsLabel').textContent = t.vibration;
      document.getElementById('settingsStatsLabel').textContent = t.unusedWords;
      document.getElementById('btnResetUsedWords').textContent = t.resetUsedBtn;

      document.getElementById('toggleSfx').classList.toggle('on', gameState.sfxEnabled);
      document.getElementById('toggleHaptics').classList.toggle('on', gameState.hapticsEnabled);

      document.getElementById('settingsLangEn').classList.toggle('selected', gameState.language === 'en');
      document.getElementById('settingsLangFa').classList.toggle('selected', gameState.language === 'fa');
    }

    function setLanguageFromSettings(lang) {
      playSfx('tap');
      haptic('tap');
      setLanguage(lang);
      syncSettingsUI();
      renderDifficultyStats();
      savePrefs();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LANGUAGE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function setLanguage(lang) {
      gameState.language = lang;
      document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
      document.body.className = lang === 'fa'
        ? 'h-full bg-gradient font-persian overflow-hidden'
        : 'h-full bg-gradient font-english overflow-hidden';
      updateTranslations();

      // If Settings is open, refresh its UI + stats immediately (no need to close/reopen)
      const modal = document.getElementById('settingsModal');
      if (modal && modal.classList.contains('active')) {
        syncSettingsUI();
        renderDifficultyStats();
      }
    }

    function updateTranslations() {
      const t = TRANSLATIONS[gameState.language];

      document.getElementById('setupTitle').textContent = t.gameSetup;
      document.getElementById('labelPlayers').textContent = t.players;
      document.getElementById('labelSpies').textContent = t.spies;
      document.getElementById('labelDuration').textContent = t.duration;
      document.getElementById('labelDifficulty').textContent = t.difficulty;
      document.getElementById('diffEasyText').textContent = t.easy;
      document.getElementById('diffNormalText').textContent = t.normal;
      document.getElementById('diffHardText').textContent = t.hard;
      document.getElementById('diffInsaneText').textContent = t.insane;
      document.getElementById('labelColors').textContent = t.themeColors;
      document.getElementById('labelPrimary').textContent = t.primary;
      document.getElementById('labelSecondary').textContent = t.secondary;
      document.getElementById('btnStart').textContent = t.startGame;
      document.getElementById('btnOpenSettings').textContent = t.settingsBtn;
      document.getElementById('tapText').textContent = t.tapToSee;
      document.getElementById('btnConfirm').textContent = t.confirmPass;
      document.getElementById('discussTitle').textContent = t.discussionTime;
      document.getElementById('btnEndDiscussion').textContent = t.startVoting;
      document.getElementById('voteTitle').textContent = t.voteForSpy;
      document.getElementById('voteSubtitle').textContent = t.whoIsSpy;
      document.getElementById('btnConfirmVote').textContent = t.confirmVotes;
      document.getElementById('revealSpyLabel').textContent = t.spiesWere;
      document.getElementById('revealWordLabel').textContent = t.wordWas;
      document.getElementById('btnPlayAgain').textContent = t.playAgain;
      document.getElementById('btnNewSetup').textContent = t.newSetup;
      document.getElementById('spyLimitHint').textContent = t.spiesLimit;

      // Difficulty chip state
      updateDifficultyUI();
      renderDifficultyStats();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SETUP CONTROLS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updatePlayerCount(value) {
      gameState.playersCount = parseInt(value);
      document.getElementById('playerCountDisplay').textContent = value;
      enforceSpyLimit();
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function enforceSpyLimit() {
      const spySlider = document.getElementById('spySlider');
      const maxSpies = Math.max(1, gameState.playersCount - 1);
      spySlider.max = String(maxSpies);
      if (gameState.spyCount > maxSpies) {
        gameState.spyCount = maxSpies;
        spySlider.value = String(maxSpies);
        document.getElementById('spyCountDisplay').textContent = String(maxSpies);
      }
    }

    function updateSpyCount(value) {
      const v = parseInt(value);
      const maxSpies = Math.max(1, gameState.playersCount - 1);
      gameState.spyCount = Math.min(v, maxSpies);
      document.getElementById('spyCountDisplay').textContent = String(gameState.spyCount);
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function updateDuration(value, silent = false) {
      gameState.gameDuration = parseInt(value);
      const mins = Math.floor(value / 60);
      const secs = value % 60;
      document.getElementById('durationDisplay').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function updatePrimaryColor(color, silent = false) {
      gameState.primaryColor = color;
      document.documentElement.style.setProperty('--primary', color);
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function updateSecondaryColor(color, silent = false) {
      gameState.secondaryColor = color;
      document.documentElement.style.setProperty('--secondary', color);
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function toggleDifficultyAccordion() {
      playSfx('tap');
      haptic('tap');
      document.getElementById('difficultyAccordion').classList.toggle('open');
    }

    function setDifficulty(diff, silent = false) {
      gameState.difficulty = diff;
      updateDifficultyUI();
      if (!silent) {
        playSfx('tap');
        haptic('tap');
      }
      savePrefs();
    }

    function updateDifficultyUI() {
      for (const d of ['easy','normal','hard','insane']) {
        const btn = document.getElementById(`diff_${d}`);
        if (btn) btn.classList.toggle('selected', gameState.difficulty === d);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // WORD PICKING (never repeats)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function chooseWord() {
      const used = loadUsedWords();
      const lang = gameState.language;
      const diff = gameState.difficulty;
      const usedSet = new Set(used[lang][diff]);
      const all = WORD_BANK_BASE[lang][diff];
      const available = all.filter(w => !usedSet.has(w));
      if (available.length === 0) {
        return null;
      }
      const word = available[Math.floor(Math.random() * available.length)];
      used[lang][diff].push(word);
      saveUsedWords(used);
      return word;
    }

    // Count words by counting quote-pairs in JSON string of the array (each word is wrapped in two quotes).
    // This avoids relying on any pre-defined totals and always reflects the actual bank content for the current language/difficulty.

    
function renderDifficultyStats() {
  const used = loadUsedWords();
  const lang = gameState.language;
  const t = TRANSLATIONS[lang];
  const el = document.getElementById('difficultyStats');
  if (!el) return;

  // Always reflect the *actual* word arrays for the CURRENT language (including any manual edits you make).
  // We also count UNIQUE words to avoid duplicates inflating totals.
  const banks = (WORD_BANK_BASE && WORD_BANK_BASE[lang]) ? WORD_BANK_BASE[lang] : {};

  const order = ['easy', 'normal', 'hard', 'insane'];
  const labelMap = {
    easy: t.stat_easy,
    normal: t.stat_normal,
    hard: t.stat_hard,
    insane: t.stat_insane
  };

  el.innerHTML = order.map((diffKey) => {
    const arr = Array.isArray(banks[diffKey]) ? banks[diffKey] : [];
    const total = new Set(arr).size;
    const seen = (used[lang] && used[lang][diffKey]) ? new Set(used[lang][diffKey]).size : 0;
    const label = labelMap[diffKey] || diffKey;
    return `<div class="flex items-center justify-between">
      <span>${label}</span>
      <span class="text-white/70">${seen}/${total}</span>
    </div>`;
  }).join('');
}



    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GAME START
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startGame() {
      // pick word first; if none, don't start
      const word = chooseWord();
      const t = TRANSLATIONS[gameState.language];
      if (!word) {
        playSfx('danger');
        haptic('danger');
        showToast(t.noWordsLeft);
        const setup = document.getElementById('setupScreen');
        setup.classList.add('shake');
        setTimeout(() => setup.classList.remove('shake'), 520);
        return;
      }

      playSfx('start');
      haptic('start');

      // Reset game
      gameState.currentPlayerIndex = 0;
      gameState.votes = new Array(gameState.playersCount).fill(-1);
      gameState.roleRevealed = false;
      gameState.currentWord = word;

      // Select spies randomly (unique)
      const idxs = [];
      while (idxs.length < gameState.spyCount) {
        const r = Math.floor(Math.random() * gameState.playersCount);
        if (!idxs.includes(r)) idxs.push(r);
      }
      gameState.spyIndices = idxs;

      setupRoleScreen();
      showScreen('roleScreen');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ROLE REVEAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function setupRoleScreen() {
      const t = TRANSLATIONS[gameState.language];
      document.getElementById('playerLabel').textContent = `${t.player} ${gameState.currentPlayerIndex + 1}`;
      document.getElementById('tapPrompt').classList.remove('hidden');
      document.getElementById('roleRevealed').classList.add('hidden');
      document.getElementById('btnConfirm').classList.add('hidden');

      const roleCard = document.getElementById('roleCard');
      roleCard.classList.remove('glow-danger', 'glow-success', 'shake');
      roleCard.classList.add('breathing');

      gameState.roleRevealed = false;
    }

    function revealRole() {
      if (gameState.roleRevealed) return;
      gameState.roleRevealed = true;

      const t = TRANSLATIONS[gameState.language];
      const isSpy = gameState.spyIndices.includes(gameState.currentPlayerIndex);
      const roleCard = document.getElementById('roleCard');

      roleCard.classList.remove('breathing');
      document.getElementById('tapPrompt').classList.add('hidden');
      document.getElementById('roleRevealed').classList.remove('hidden');

      const roleIcon = document.getElementById('roleIcon');
      const roleText = document.getElementById('roleText');
      const wordText = document.getElementById('wordText');

      playSfx('reveal');
      haptic(isSpy ? 'spy' : 'reveal');

      if (isSpy) {
        roleIcon.textContent = 'ğŸ•µï¸';
        roleText.textContent = t.youAreSpy;
        roleText.style.color = '#FF1744';
        wordText.textContent = t.hidden;
        wordText.style.color = '#FF1744';
        roleCard.classList.add('glow-danger', 'shake');
        setTimeout(() => roleCard.classList.remove('shake'), 500);
      } else {
        roleIcon.textContent = 'ğŸ‘¤';
        roleText.textContent = t.youAreNormal;
        roleText.style.color = gameState.primaryColor;
        wordText.textContent = gameState.currentWord;
        wordText.style.color = '#FFFFFF';
        roleCard.classList.add('glow-success');
      }

      document.getElementById('roleRevealed').classList.add('spy-reveal');

      setTimeout(() => {
        document.getElementById('btnConfirm').classList.remove('hidden');
        document.getElementById('btnConfirm').classList.add('slide-up');
      }, 400);
    }

    function confirmRole() {
      playSfx('confirm');
      haptic('confirm');
      gameState.currentPlayerIndex++;

      if (gameState.currentPlayerIndex >= gameState.playersCount) {
        startDiscussion();
      } else {
        setupRoleScreen();
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DISCUSSION TIMER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startDiscussion() {
      showScreen('timerScreen');
      gameState.timeRemaining = gameState.gameDuration;
      updateTimerDisplay();

      const circumference = 2 * Math.PI * 70;
      const ring = document.getElementById('timerRing');
      ring.style.strokeDasharray = circumference;
      ring.style.stroke = 'var(--primary)';

      if (gameState.timerInterval) clearInterval(gameState.timerInterval);

      // Give a small haptic cue that timer started
      haptic('start');

      gameState.timerInterval = setInterval(() => {
        gameState.timeRemaining--;
        updateTimerDisplay();

        const progress = gameState.timeRemaining / gameState.gameDuration;
        const offset = circumference * (1 - progress);
        ring.style.strokeDashoffset = offset;

        // Last 10 seconds: red + tick-tock each second
        if (gameState.timeRemaining <= 10 && gameState.timeRemaining >= 0) {
          ring.style.stroke = '#FF1744';
          playSfx('tick');
          haptic('tick');
        }

        if (gameState.timeRemaining <= 0) {
          clearInterval(gameState.timerInterval);
          endDiscussion();
        }
      }, 1000);

      setTimeout(() => {
        document.getElementById('btnEndDiscussion').classList.remove('hidden');
      }, 5000);
    }

    function updateTimerDisplay() {
      const mins = Math.floor(gameState.timeRemaining / 60);
      const secs = gameState.timeRemaining % 60;
      document.getElementById('timerDisplay').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function endDiscussion() {
      playSfx('confirm');
      haptic('confirm');
      if (gameState.timerInterval) clearInterval(gameState.timerInterval);
      startVoting();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VOTING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function startVoting() {
      showScreen('votingScreen');
      gameState.currentPlayerIndex = 0;
      gameState.votes = new Array(gameState.playersCount).fill(-1);

      const grid = document.getElementById('votingGrid');
      grid.innerHTML = '';

      const t = TRANSLATIONS[gameState.language];

      for (let i = 0; i < gameState.playersCount; i++) {
        const card = document.createElement('button');
        card.className = 'glass-card rounded-2xl p-6 cursor-pointer scale-in transition-all duration-300 hover:scale-105';
        card.style.animationDelay = `${i * 0.1}s`;
        card.innerHTML = `
          <div class="text-4xl mb-2">ğŸ‘¤</div>
          <div class="text-lg font-semibold text-white">${t.player} ${i + 1}</div>
          <div class="text-sm text-white/50 mt-1 vote-count" id="votes-${i}">0 votes</div>
        `;
        card.onclick = () => castVote(i);
        card.id = `player-card-${i}`;
        grid.appendChild(card);
      }

      document.getElementById('btnConfirmVote').classList.add('hidden');
      updateVotingUI();
    }

    function castVote(playerIndex) {
      playSfx('vote');
      haptic('vote');

      gameState.votes[gameState.currentPlayerIndex] = playerIndex;
      gameState.currentPlayerIndex++;

      updateVotingUI();

      if (gameState.currentPlayerIndex >= gameState.playersCount) {
        document.getElementById('btnConfirmVote').classList.remove('hidden');
        document.getElementById('btnConfirmVote').classList.add('slide-up');
      }
    }

    function updateVotingUI() {
      const voteCounts = new Array(gameState.playersCount).fill(0);
      gameState.votes.forEach(v => { if (v >= 0) voteCounts[v]++; });

      for (let i = 0; i < gameState.playersCount; i++) {
        const voteEl = document.getElementById(`votes-${i}`);
        if (voteEl) voteEl.textContent = `${voteCounts[i]} votes`;

        const card = document.getElementById(`player-card-${i}`);
        if (card) {
          if (voteCounts[i] > 0) card.classList.add('voted');
          else card.classList.remove('voted');
        }
      }

      const t = TRANSLATIONS[gameState.language];
      document.getElementById('voteSubtitle').textContent =
        gameState.currentPlayerIndex < gameState.playersCount
          ? `${t.player} ${gameState.currentPlayerIndex + 1} - ${t.whoIsSpy}`
          : t.selectAll;
    }

    function confirmVotes() {
      playSfx('confirm');
      haptic('confirm');

      const voteCounts = new Array(gameState.playersCount).fill(0);
      gameState.votes.forEach(v => { if (v >= 0) voteCounts[v]++; });

      let maxVotes = -1;
      let mostVoted = -1;
      voteCounts.forEach((count, idx) => {
        if (count > maxVotes) { maxVotes = count; mostVoted = idx; }
      });

      const playersWon = gameState.spyIndices.includes(mostVoted);
      showResult(playersWon);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RESULT SCREEN
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showResult(playersWon) {
      showScreen('resultScreen');

      const t = TRANSLATIONS[gameState.language];
      const resultCard = document.getElementById('resultCard');
      const resultIcon = document.getElementById('resultIcon');
      const resultTitle = document.getElementById('resultTitle');
      const resultMessage = document.getElementById('resultMessage');

      if (playersWon) {
        playSfx('win');
        haptic('win');
        resultIcon.textContent = 'ğŸ‰';
        resultTitle.textContent = t.playersFound;
        resultTitle.style.color = '#00E676';
        resultMessage.textContent = '';
        resultCard.classList.add('glow-success');
        resultCard.classList.remove('glow-danger');
      } else {
        playSfx('lose');
        haptic('lose');
        resultIcon.textContent = 'ğŸ•µï¸';
        resultTitle.textContent = t.spyWins;
        resultTitle.style.color = '#FF1744';
        resultMessage.textContent = '';
        resultCard.classList.add('glow-danger');
        resultCard.classList.remove('glow-success');
      }

      const spiesText = gameState.spyIndices
        .map(i => `${t.player} ${i + 1}`)
        .join(gameState.language === 'fa' ? 'ØŒ ' : ', ');

      document.getElementById('revealSpy').textContent = spiesText;
      document.getElementById('revealWord').textContent = gameState.currentWord;
    }

    function playAgain() {
      playSfx('start');
      haptic('start');
      startGame();
    }

    function newSetup() {
      playSfx('tap');
      haptic('tap');
      showScreen('setupScreen');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PARTICLES SYSTEM (unchanged)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function createParticles() {
      const container = document.getElementById('particles');
      container.innerHTML = '';
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.opacity = 0.2 + Math.random() * 0.3;
        particle.style.width = (3 + Math.random() * 4) + 'px';
        particle.style.height = particle.style.width;
        container.appendChild(particle);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // expandWordBank(); // disabled: do not mutate the curated banks; counts reflect the literal arrays
    createParticles();

    // Load prefs before applying UI
    loadPrefs();

    // Apply saved theme/colors
    document.documentElement.style.setProperty('--primary', gameState.primaryColor);
    document.documentElement.style.setProperty('--secondary', gameState.secondaryColor);

    // Apply saved inputs
    document.getElementById('playerSlider').value = String(gameState.playersCount);
    document.getElementById('playerCountDisplay').textContent = String(gameState.playersCount);

    document.getElementById('durationSlider').value = String(gameState.gameDuration);
    updateDuration(gameState.gameDuration, true);

    document.getElementById('primaryColor').value = gameState.primaryColor;
    document.getElementById('secondaryColor').value = gameState.secondaryColor;

    enforceSpyLimit();
    document.getElementById('spySlider').value = String(gameState.spyCount);
    document.getElementById('spyCountDisplay').textContent = String(gameState.spyCount);

    // Language and texts
    setLanguage(gameState.language);

    // Ripple + global sound for buttons (only for glass-button)
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.glass-button');
      if (btn) {
        // ripple
        const rect = btn.getBoundingClientRect();
        const ripple = document.createElement('span');
        ripple.className = 'ripple';
        ripple.style.left = (e.clientX - rect.left) + 'px';
        ripple.style.top = (e.clientY - rect.top) + 'px';
        btn.style.position = 'relative';
        btn.style.overflow = 'hidden';
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }
    });

    // Pre-sync settings toggles
    syncSettingsUI();
    renderDifficultyStats();
  </script>
</body>
</html>
